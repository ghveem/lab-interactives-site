{
  "title": "Flying Zippies - Model of Solid Tipping",
  "publicationStatus": "draft",
  "subtitle": "Sliding on the cart...",
  "category": "",
  "subCategory": "",
  "screenshot": "",
  "aspectRatio": 1.777777778,
  "fontScale": 1,
  "lang": "en-US",
  "i18nMetadata": "",
  "helpOnLoad": false,
  "theme": "no-framing", "showTopBar": false,
  "showBottomBar": false,
  "padding": 0,
  "about": "",
  "models": [
    {
      "type": "md2d",
      "id": "empty-atom",
      "url": "models/lab-version/1/md2d/sensing-science/flying-zippies/zippy-solid-tipping.json",
      "viewOptions": {
        "showVDWLines": true,
        "viewPortX": 1.0,
        "viewPortY": 1.0,
        "viewPortWidth": 12.5,
        "viewPortHeight": 7.03124
      },
      "onLoad": [
        "var INTERVAL = get('timeStep') * get('timeStepsPerTick') * 3;",
        "var DELTA_SPEED = 0.0002;",
        "var vxBoost = DELTA_SPEED * 0.8660;",
        "var vyBoost = DELTA_SPEED * 0.5;",
        "var isLeftTilt = true;",
        "var isTilting = false;",
        "var startTime;",
        "var presentTime;",
        "set({temperatureControl: false}); set({targetTemperature: 300});",      
        "var airAtoms = [];",
        "var zippyAtoms = [];",
        "var cartAtoms = [];",
        "var airAtomsIndices = [];",
        "var zippyAtomsIndices = [];",
        "var cartAtomsIndices = [];",
        "for (var i = 0, a; i < getNumberOfAtoms(); i++) {",
        "  a = getAtomProperties(i);",
        "  if (a.element == 0) {airAtoms.push(a); airAtomsIndices.push(i);}", 
        "  if (a.element == 1) {zippyAtoms.push(a); zippyAtomsIndices.push(i);}",
        "  if (a.element == 2) {cartAtoms.push(a); cartAtomsIndices.push(i);}",
        "}",
        "//console.log('air: ' + airAtoms.length + ' zippy: ' + zippyAtoms.length + ' cart: ' + cartAtoms.length );",
        "set('airAtomsIndices', airAtomsIndices);",
        "set('zippyAtomsIndices', zippyAtomsIndices);",
        "set('cartAtomsIndices', cartAtomsIndices);",
        "//console.log('zippyAtomsIndices: ' + zippyAtomsIndices );",
        "//console.log('airAtomsIndices: ' + airAtomsIndices );",
        "start();",         
        "onPropertyChange('time',function(t) {",
        " presentTime = t;",
        " if (presentTime % 100 === 0) {",
        "   var zippytemp = getTemperatureOfAtoms(get('zippyAtomsIndices'));",
        "   var airtemp = getTemperatureOfAtoms(get('airAtomsIndices'));",
        "   //console.log('zippy temp: ' + zippytemp + ' air temp: ' + airtemp);",        
        "   if (zippytemp >= 2000) ",
        "       addKEToAtoms(-0.5, get( 'zippyAtomsIndices' ));",
        "   if (airtemp >= 5000) ",
        "       addKEToAtoms(-0.5, get( 'airAtomsIndices' ));",
        "   else if (airtemp <= 2000) ",
        "      addKEToAtoms(0.5, get ('zippyAtomsIndices' ));", 
        " }",
        "  if (presentTime % 3000 === 0 || isTilting) {",
        "    if (!isTilting) { startTime = presentTime; isTilting = true; }", 
        "    if (isLeftTilt) {",
        "      if (presentTime === startTime) {setImageProperties(0, {visible: false}); slideZippies( -vxBoost, -vyBoost);}",
        "      if (presentTime === startTime + 50) {setImageProperties(1, {visible: false}); slideZippies(-vxBoost ,-vyBoost); }",
        "      if (presentTime === startTime + 100) {setImageProperties(2, {visible: false}); slideZippies(-vxBoost ,-vyBoost); }",
        "      if (presentTime === startTime + 150) {setImageProperties(3, {visible: false}); slideZippies(-vxBoost ,-vyBoost);}",
        "      if (presentTime === startTime + 200) {setImageProperties(4, {visible: false}); slideZippies(-vxBoost ,-vyBoost);}",                    
        "      if (presentTime === startTime + 250) {setImageProperties(5, {visible: false}); isTilting = false; isLeftTilt = false;}",
        "      //console.log('vx: ' + averageZippyXVelocity() + ' vy: ' + averageZippyYVelocity() );",
        "    } else {",
        "      if (presentTime === startTime)  {setImageProperties(5, {visible: true}); slideZippies( vxBoost, vyBoost); }",
        "      if (presentTime === startTime + 50) {setImageProperties(4, {visible: true});  slideZippies( vxBoost ,vyBoost);}",
        "      if (presentTime === startTime + 100) {setImageProperties(3, {visible: true}); slideZippies( vxBoost ,vyBoost);}",              
        "      if (presentTime === startTime + 150) {setImageProperties(2, {visible: true}); slideZippies( vxBoost ,vyBoost);}",
        "      if (presentTime === startTime + 200) {setImageProperties(1, {visible: true}); slideZippies( vxBoost ,vyBoost);}",
        "      if (presentTime === startTime + 250) {setImageProperties(0, {visible: true}); isTilting = false; isLeftTilt = true;}",
        "    }",
        "  }",
        "});",
        "function tippingLeft() {",
        "  setElectricFieldProperties( 0, {orientation: 'E', intensity: 0.4});",
        "//  for (var i = 0, idx; i < zippyAtomsIndices.length; i++ ) {",
        "//    idx = zippyAtomsIndices[i];",
        "//    setAtomProperties( idx, {friction: 0.005 } );",
        "//  }",
        "//  setPairwiseLJProperties(1, 1, { epsilon: -0.5 });",        
        "}",
        "function tippingRight() {",
        "  setElectricFieldProperties( 0, {orientation: 'W', intensity: 0.4});",
        "//  for (var i = 0, idx; i < zippyAtomsIndices.length; i++ ) {",
        "//    idx = zippyAtomsIndices[i];",
        "//    setAtomProperties( idx, {friction: 0.005 } );",
        "//  }",
        "//  setPairwiseLJProperties(1, 1, { epsilon: -0.5 });",        
        "}",   
        "function averageZippyXVelocity() {",
        "   var sum = 0;",
        "   var atom;",
        "   for (var i = 0; i < zippyAtoms.length; i++) {",
        "      atom = getAtomProperties( zippyAtoms[i] );",
        "      sum = sum + atom.vx;",
        "   }",
        "   return sum / zippyAtomsIndices.length;",
        "}",
        "function averageZippyYVelocity() {",
        "   var sum = 0;",
        "   var atom;",
        "   for (var i = 0; i < zippyAtoms.length; i++) {",
        "      atom = getAtomProperties( zippyAtoms[i] );",
        "      sum = sum + atom.vy;",
        "   }",
        "   return sum / zippyAtomsIndices.length;",
        "}",        
        "function boostVelocity(xDelta, yDelta) {",
        "  var atom;",
        "  for (var i = 0; i < zippyAtoms.length; i++) {",
        "     atom = getAtomProperties( zippyAtomsIndices[i]);",
        "     setAtomProperties(zippyAtomsIndices[i], {vx:atom.vx + xDelta, vy:atom.vy + yDelta});",
        "  }",
        "}",
        "function distanceFromCenter() {",
        "  var atom = getAtomProperties(60);",
        "  var x1 = atom.x;",
        "  var y1 = atom.y;",
        "  var xDist = 7.18 - x1;",
        "  var yDist = 4.3 - y1;",
        "  return Math.sqrt( xDist * xDist + yDist * yDist);",
        "}",        
        "function slideZippies( dx, dy ) {",
        "  batch(function () {",
        "    boostVelocity(dx, dy);",
        "  });",
        "}"
      ]
    }
  ],
    "parameters": [
    {
      "name": "airAtomsIndices",
      "initialValue": []
    },
    {   "name": "zippyAtomsIndices",
       "initialValue": []
    },
    {   "name": "cartAtomsIndices",
       "initialValue": []
    }    
  ],
  "outputs": [
    {
      "name": "temperature-air",
      "unitAbbreviation": "K",
      "label": "speed",
      "value": "return getTemperatureOfAtoms(get('airAtomsIndices'));"
    },
    {
      "name": "temperature-zippy",
      "unitAbbreviation": "K",
      "label": "speed",
      "value": "return getTemperatureOfAtoms(get('zippyAtomsIndices'));"
    }
  ],
  "components": [],
  "layout": {},
  "template": "model-only"
}
