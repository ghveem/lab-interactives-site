{
  "title": "Flying Zippies - Zippies Returning to the Ring",
  "publicationStatus": "draft",
  "subtitle": "The torches go out and the air slows down...",
  "category": "",
  "subCategory": "",
  "screenshot": "",
  "aspectRatio": 1.777777778,
  "fontScale": 1,
  "lang": "en-US",
  "i18nMetadata": "",
  "helpOnLoad": false,
  "theme": "no-framing", "showTopBar": false,
  "showBottomBar": false,
  "padding": 0, 
  "about": "",
  "models": [
    {
      "type": "md2d",
      "id": "empty-atom",
      "url": "models/lab-version/1/md2d/sensing-science/flying-zippies/zippy-torches-going-out.json",
      "viewOptions": {
        "showVDWLines": true,
        "viewPortX": 1.0,
        "viewPortY": 1.0,
        "viewPortWidth": 12.5,
        "viewPortHeight": 7.03124,
        "electricFieldDensity": 24,
        "electricFieldColor": "rgb(0,255,0)",
        "showElectricField": true      
      },
      "onLoad": [
        "var INTERVAL = get('timeStep') * get('timeStepsPerTick') * 3;",
        "var modelStartTime = 0;",
        "var startLoopTime = 0;",
        "var presentTime = 0;",
        "var isLit = true;",
        "var isFirstTime = true;",
        "var triggerElectricField = true;",
        "var frameCt = 3;",
        "var delayCt = 50;",        
        "var setTemperature = 30000;",
        "set({temperatureControl: true}); set({targetTemperature: setTemperature});",      
        "var airAtoms = [];",
        "var zippyAtoms = [];",
        "var cartAtoms = [];",
        "var airAtomsIndices = [];",
        "var zippyAtomsIndices = [];",
        "var cartAtomsIndices = [];",     
        "for (var i = 0, a; i < getNumberOfAtoms(); i++) {",
        "  a = getAtomProperties(i);",
        "  if (a.element == 0) {airAtoms.push(a); airAtomsIndices.push(i);}", 
        "  if (a.element == 1) {zippyAtoms.push(a); zippyAtomsIndices.push(i);}",
        "  if (a.element == 2) {cartAtoms.push(a); cartAtomsIndices.push(i);}",
        "}",
        "set('airAtomsIndices', airAtomsIndices);",
        "set('zippyAtomsIndices', zippyAtomsIndices);",
        "set('cartAtomsIndices', cartAtomsIndices);",
        "console.log('zippyAtomsIndices: ' + zippyAtomsIndices );",
        "console.log('airAtomsIndices: ' + airAtomsIndices );",  
        "//console.log('isLightingTorches1: ' + get('isLightingTorches'));",
        "setImageProperties([0,1,2], {visible: true});", 
        "setImageProperties([3,4,5,6,7,8,9,10,11,12,13,14,15], {visible: false});",         
        "setElectricFieldProperties( 0, {orientation: 'S', intensity: 0.0});", 
        "//setElementProperties(1, {charge: -1.0});",
        "set('showElectricField',false);",
        "start();",
        "startLoopTime = get( 'time' );",
        "onPropertyChange('time',function(t) {",
        "  presentTime = t;",   
        "  if (!isLit) { //this if statement takes care of changing the temperature", 
        "    if (presentTime % 10 === 0) {",
        "      if (setTemperature > 1000) {",
        "        setTemperature -= 100;",
        "        set({targetTemperature: setTemperature});",
        "      }",
        "      //var zippytemp = getTemperatureOfAtoms(get('zippyAtomsIndices'));",
        "      //var airtemp = getTemperatureOfAtoms(get('airAtomsIndices'));",
        "      //console.log('zippy temp: ' + zippytemp + ' air temp: ' + airtemp);", 
        "      if (setTemperature < 1200 && triggerElectricField) {",
        "        setElectricFieldProperties(0, {orientation: 'S', intensity: 0.001, shapeIdx: null});", 
        "        for (var i = 0; i < zippyAtomsIndices.length; i++) {",
        "          setAtomProperties(zippyAtomsIndices[i], {charge: 0.001});",
        "        }",
        "        triggerElectricField = false;",
        "      }",
        "      if (setTemperature < 1400 ) {",  
        "        for (var i = 0, a; i < getNumberOfAtoms(); i++) {",
        "          a = getAtomProperties(i);",
        "          if (a.element === 1 && a.y < 0.85) {",
        "            removeAtom(i);",
        "            console.log('atom removed: ' + i)",
        "          }",
        "        }", 
        "      }", 
        "    }",
        "  }",
        "  if (get('isPuttingTorchesOut')) { //this if statement animates putting out the torches",
        "    if (isFirstTime) {",
        "      modelStartTime = presentTime;", 
        "      isLit = false;",
        "      isFirstTime = false;",
        "      setImageProperties([0,1,2], {visible: false});", 
        "      setImageProperties(3, {visible: true});", 
        "    }",
        "    if (presentTime === (modelStartTime + delayCt)) {",
        "      //console.log('frameCt: ' + frameCt + ' delayCt: ' + delayCt );",
        "      setImageProperties(frameCt+1, {visible: true});",
        "      setImageProperties(frameCt, {visible: false});",        
        "      frameCt++;",
        "      delayCt += 50;",
        "      if (frameCt === 15) { ",
        "        setImageProperties(15, {visible: true});",
        "        setImageProperties([1,2,3,4,5,6,7,8,9,10,11,12,13,14], {visible: false});",         
        "        set('isPuttingTorchesOut', false);",
        "      }",
        "    }",
        "  }",
        "  if (isLit) { //this if statement animates the torches when fully lit",         
        "    if (presentTime === startLoopTime + 50)  {setImageProperties(0, {visible: false});}",
        "    if (presentTime === startLoopTime + 100) {setImageProperties(1, {visible: false});}",
        "    if (presentTime === startLoopTime + 150) {setImageProperties(1, {visible: true});}",  
        "    if (presentTime === startLoopTime + 200) {",
        "      setImageProperties(0, {visible: true});",
        "      startLoopTime = presentTime;",
        "    }",
        "  }",
        "});"
      ]
    }
  ],
    "parameters": [ 
    { "name": "isPuttingTorchesOut",
      "initialValue": false
    },
    {
      "name": "airAtomsIndices",
      "initialValue": []
    },
    {   "name": "zippyAtomsIndices",
       "initialValue": []
    },
    {   "name": "cartAtomsIndices",
       "initialValue": []
    }    
  ],
  "outputs": [
    {
      "name": "temperature-air",
      "unitAbbreviation": "K",
      "label": "speed",
      "value": "return getTemperatureOfAtoms(get('airAtomsIndices'));"
    },
    {
      "name": "temperature-zippy",
      "unitAbbreviation": "K",
      "label": "speed",
      "value": "return getTemperatureOfAtoms(get('zippyAtomsIndices'));"
    }
  ],
  "components": [
    {
      "type": "button",
      "id": "put-out-torches",
      "text": "Put the Torches Out",
      "action": [ 
        "set( 'isPuttingTorchesOut', true );",
        "setComponentDisabled('put-out-torches', true);"
       ]
    },
    {
      "type": "button",
      "id": "reset",
      "text": "See It Again",
      "action": [ 
      "reloadModel();",
      "setComponentDisabled('put-out-torches', false);"      
       ]
    }
  ],
  "layout": {},
  "template": "model-only"
}
